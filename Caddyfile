{
    # Abilita logging basilare
    # auto_https on
}

{$APP_DOMAIN} {
    encode zstd gzip
    root * /var/www/gestionale
    
    # Servi i file statici direttamente se esistono (prima di PHP)
    @static {
        path *.css *.js *.jpg *.jpeg *.png *.gif *.svg *.ico *.woff *.woff2 *.ttf *.eot
    }
    handle @static {
        file_server
    }
    
    # Tutto il resto va a PHP
    php_fastcgi php:9000
    try_files {path} {path}/ /index.php?{query}
    file_server
}

{$BOT_DOMAIN} {
    reverse_proxy bot:3000
}

{$N8N_DOMAIN} {
    reverse_proxy n8n:5678
}

{$PANEL_DOMAIN} {
    reverse_proxy panel:4000
}

# Nota: in ambienti locali senza DNS pubblico Ã¨ possibile disabilitare TLS automatico
# aggiungendo la direttiva `auto_https off` nel blocco globale e usando hostnames
# come :80 o domini risolti nel /etc/hosts.


